<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waypoints</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="bg-white rounded-xl shadow-lg w-full max-w-md overflow-hidden">
        <!-- Header -->
        <div class="bg-blue-600 p-6 text-center">
            <h1 class="text-2xl font-bold text-white flex items-center justify-center gap-2">
                <i class="ph ph-map-trifold"></i> Waypoints
            </h1>
            <p class="text-blue-100 text-sm mt-1">Convert addresses to Latitude & Longitude</p>
        </div>

        <!-- Content -->
        <div class="p-6">
            <form id="geoForm" class="space-y-4">
                <div>
                    <label for="address" class="block text-sm font-medium text-gray-700 mb-1">Street Address</label>
                    <textarea 
                        id="address" 
                        rows="3" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition resize-none"
                        placeholder="e.g., 1600 Amphitheatre Parkway, Mountain View, CA"
                        required></textarea>
                </div>

                <button 
                    type="submit" 
                    id="submitBtn"
                    class="w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span>Get Coordinates</span>
                    <i class="ph ph-magnifying-glass"></i>
                </button>
            </form>

            <!-- Loading State -->
            <div id="loading" class="hidden mt-6 text-center text-gray-500 flex flex-col items-center">
                <div class="loader mb-2"></div>
                <p class="text-sm">Searching global database...</p>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden mt-6 bg-red-50 border-l-4 border-red-500 p-4 rounded">
                <div class="flex items-center">
                    <i class="ph ph-warning-circle text-red-500 text-xl mr-2"></i>
                    <p class="text-red-700 font-medium" id="errorText">Address not found.</p>
                </div>
            </div>

            <!-- Result Card -->
            <div id="resultCard" class="hidden mt-6 bg-gray-50 border border-gray-200 rounded-lg p-4">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Results</h3>
                
                <div class="grid grid-cols-1 gap-4 mb-4">
                    <!-- Latitude Block -->
                    <div class="bg-white p-3 rounded shadow-sm border border-gray-100 flex justify-between items-center">
                        <span class="text-xs text-gray-500 font-medium uppercase tracking-wide w-20">Latitude</span>
                        <div class="text-right">
                            <span id="latDMS" class="block font-mono font-bold text-gray-800 text-lg whitespace-nowrap">--</span>
                            <span id="latDisplay" class="block font-mono text-xs text-gray-400 mt-0.5">--</span>
                        </div>
                    </div>

                    <!-- Longitude Block -->
                    <div class="bg-white p-3 rounded shadow-sm border border-gray-100 flex justify-between items-center">
                        <span class="text-xs text-gray-500 font-medium uppercase tracking-wide w-20">Longitude</span>
                        <div class="text-right">
                            <span id="lonDMS" class="block font-mono font-bold text-gray-800 text-lg whitespace-nowrap">--</span>
                            <span id="lonDisplay" class="block font-mono text-xs text-gray-400 mt-0.5">--</span>
                        </div>
                    </div>
                </div>

                <div class="border-t border-gray-200 pt-3 mb-4">
                    <p class="text-xs text-gray-500 mb-1">Formatted Address found:</p>
                    <p id="foundAddress" class="text-sm text-gray-700 italic leading-relaxed"></p>
                </div>

                <!-- Map Links -->
                <div class="flex gap-2">
                    <a id="googleMapsLink" href="#" target="_blank" class="flex-1 bg-white border border-gray-300 text-gray-700 py-2 px-3 rounded text-sm font-medium hover:bg-gray-50 text-center transition flex items-center justify-center gap-2">
                        <i class="ph ph-google-logo text-lg"></i>
                        Google Maps
                    </a>
                    <a id="osmLink" href="#" target="_blank" class="flex-1 bg-white border border-gray-300 text-gray-700 py-2 px-3 rounded text-sm font-medium hover:bg-gray-50 text-center transition flex items-center justify-center gap-2">
                        <i class="ph ph-map-trifold text-lg"></i>
                        OSM
                    </a>
                </div>
            </div>
        </div>
        
        <div class="bg-gray-50 px-6 py-3 border-t border-gray-100">
            <p class="text-xs text-center text-gray-400">Powered by OpenStreetMap & Nominatim</p>
        </div>
    </div>

    <script>
        const form = document.getElementById('geoForm');
        const addressInput = document.getElementById('address');
        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const resultCard = document.getElementById('resultCard');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');

        const latDisplay = document.getElementById('latDisplay');
        const lonDisplay = document.getElementById('lonDisplay');
        const latDMSDisplay = document.getElementById('latDMS');
        const lonDMSDisplay = document.getElementById('lonDMS');
        const foundAddress = document.getElementById('foundAddress');
        const osmLink = document.getElementById('osmLink');
        const googleMapsLink = document.getElementById('googleMapsLink');

        function toDMS(coordinate, isLat) {
            const absolute = Math.abs(coordinate);
            const degrees = Math.floor(absolute);
            const minutesNotTruncated = (absolute - degrees) * 60;
            const minutes = Math.floor(minutesNotTruncated);
            const seconds = (minutesNotTruncated - minutes) * 60;
            
            // Pad minutes with leading zero if needed (e.g. 5 -> 05)
            const minutesStr = minutes.toString().padStart(2, '0');
            
            // Format seconds: 2 decimal places, pad start to ensure integer part has 2 digits (e.g. 1.23 -> 01.23)
            // 5 characters total for "XX.XX"
            const secondsStr = seconds.toFixed(2).padStart(5, '0');

            let direction = "";
            if (isLat) {
                direction = coordinate >= 0 ? "N" : "S";
            } else {
                direction = coordinate >= 0 ? "E" : "W";
            }

            return `${direction} ${degrees}Â°${minutesStr}'${secondsStr}"`;
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const address = addressInput.value.trim();
            
            if (!address) return;

            // Reset UI
            errorMessage.classList.add('hidden');
            resultCard.classList.add('hidden');
            loading.classList.remove('hidden');
            submitBtn.disabled = true;
            submitBtn.querySelector('span').textContent = "Searching...";

            try {
                // Using OpenStreetMap Nominatim API
                const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1`;

                const response = await fetch(url, {
                    headers: {
                        'Accept-Language': 'en-US,en;q=0.5' 
                    }
                });

                if (!response.ok) throw new Error('Network response was not ok');

                const data = await response.json();

                if (data.length === 0) {
                    throw new Error('Address could not be found. Please try being more specific.');
                }

                const result = data[0];
                const lat = parseFloat(result.lat);
                const lon = parseFloat(result.lon);

                // Update UI with decimal results (Secondary)
                latDisplay.textContent = lat.toFixed(6);
                lonDisplay.textContent = lon.toFixed(6);

                // Update UI with DMS results (Primary)
                latDMSDisplay.textContent = toDMS(lat, true);
                lonDMSDisplay.textContent = toDMS(lon, false);

                foundAddress.textContent = result.display_name;
                
                // Map Links
                osmLink.href = `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=16/${lat}/${lon}`;
                googleMapsLink.href = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
                
                resultCard.classList.remove('hidden');

            } catch (error) {
                errorText.textContent = error.message;
                errorMessage.classList.remove('hidden');
            } finally {
                loading.classList.add('hidden');
                submitBtn.disabled = false;
                submitBtn.querySelector('span').textContent = "Get Coordinates";
            }
        });
    </script>
</body>
</html>